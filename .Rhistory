install.packages(c("ggplot2", "dplyr"))
getwd()
load("data/base.RData")
ls()
View(user_list)
head(user_list)
user_list$PREF_NAME %>% as.character()
library(dplyr)
user_list$PREF_NAME %>% as.character()
class(user_list)
class(user_list$PREF_NAME)
user_list$PREF_NAME <- user_list$PREF_NAME %>%as.character()
class(user_list$PREF_NAME)
View(user_list)
View(user_list)
View(details_train)
View(coupons_train)
ls()
coupons_train %>% summary()
summary(user_list)
coupons_train$USABLE_DATE_MON %>% unique()
coupons_train$USABLE_DATE_BEFORE_HOLIDAY %>% unique()
coupons_train$USABLE_DATE_HOLIDAY %>% unique()
as.factor(coupons_train$USABLE_DATE_MON) %>% summary()
as.factor(coupons_train$USABLE_DATE_TUE) %>% summary()
as.factor(coupons_train$USABLE_DATE_WED) %>% summary()
as.factor(coupons_train$USABLE_DATE_THU) %>% summary()
as.factor(coupons_train$USABLE_DATE_FRI) %>% summary()
as.factor(coupons_train$USABLE_DATE_SAY) %>% summary()
as.factor(coupons_train$USABLE_DATE_SAT) %>% summary()
as.factor(coupons_train$USABLE_DATE_SUN) %>% summary()
as.factor(coupons_train$USABLE_DATE_HOLIDAY) %>% summary()
as.factor(coupons_train$USABLE_DATE_BEFORE_HOLIDAY) %>% summary()
coupons_train$small_area_name %>% unique() %>% length()
coupons_train$large_area_name %>% unique() %>% length()
coupons_train$ken_name %>% unique() %>% length()
getwd()
ls()
library(dplyr)
library(ggplot2)
load("data/base.RData")
ls()
names(coupons_train)
grepl("USABLE", names(coupons_train))
grep("USABLE", names(coupons_train))
names(coupons_train)[grepl("USABLE", names(coupons_train))]
coupons_train %>% select(names(coupons_train)[grepl("USABLE", names(coupons_train))]) %>% cor()
coupons_train %>% select(names(coupons_train)[grepl("USABLE", names(coupons_train))]) %>% head()
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% head()
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% cor()
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% dim()
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% filter(is.na())
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% shape
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% dim()
19413 - 12408
coupons_train$USABLE_DATE_MON %>% summary()
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% cor()
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% summary()
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% apply(as.factor())
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% apply(as.factor
;
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% apply(as.factor)
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% as.factor()
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% princomp()
mod <- coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% princomp()
mod$loadings
mod
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% sapply(as.factor)
coupons_train %>% select(grep("USABLE", names(coupons_train))) %>% na.omit() %>% sapply(as.factor) %>% summary()
ls()
coupons_area_train %>% summary()
val <- coupons_area_train$COUPON_ID_hash
val <- val %>% groupby(COUPON_ID_hash) %>% summarise(COUNT=n())
val <- val %>% group_by(COUPON_ID_hash) %>% summarise(COUNT=n())
val <- as.data.frame(val) %>% group_by(COUPON_ID_hash) %>% summarise(COUNT=n())
val
val <- as.data.frame(val)
val %>% head()
names(val) = 'COUPON_ID_hash'
val %>% head()
val <- val %>% group_by(COUPON_ID_hash) %>% summarise(COUNT=n())
val
qplot(val)
val <- val %>% group_by(COUNT) %>% summarise(NUM_IDS=n())
val %>% head()
qplot(x=NUM_IDS, y=COUNT, data=val)
summary(coupons_area_train)
coupons_area_train %>% filter(COUPON_ID_hash = '102f4950a16930bdeb0608ed6ce4d36a')
coupons_area_train %>% filter(COUPON_ID_hash = 102f4950a16930bdeb0608ed6ce4d36a)
coupons_area_train %>% filter(COUPON_ID_hash == '102f4950a16930bdeb0608ed6ce4d36a')
coupons_area_train %>% filter(COUPON_ID_hash == '102f4950a16930bdeb0608ed6ce4d36a') %>% select(PREF_NAME) %>% unique() %>% length()
coupons_area_train %>% filter(COUPON_ID_hash == '102f4950a16930bdeb0608ed6ce4d36a') %>% select(PREF_NAME)
coupons_area_train %>% filter(COUPON_ID_hash == '102f4950a16930bdeb0608ed6ce4d36a') %>% select(PREF_NAME) %>% unique()
coupons_area_train %>% filter(COUPON_ID_hash == '102f4950a16930bdeb0608ed6ce4d36a') %>% select(PREF_NAME) %>% unique() %>% dim()
names(coupons_area_test)
names(user_list)
names(coupons_train)
coupons_area_train %>% select(SMALL_AREA_NAME) %>% unique() %>% dim()
coupons_train %>% select(small_area_name) %>% unique() %>% dim()
coupons_area_train %>% select(SMALL_AREA_NAME, PREF_NAME) %>% unique() %>% dim()
summary(coupons_area_train)
source('G:/Projects/coupon_purchase_prediction/source_R/extract.R')
ls()
load('data/base.RData')
library(dplyr)
library(ggplot2)
ls()
val
mod
locations %>% summary()
qplot(x=LATITUDE, y=LONGITUDE, data=locations)
names(coupons_area_train)
names(locations)
summary(locations)
names(coupons_area_test)
source('G:/Projects/coupon_purchase_prediction/source_R/extract.R')
ls()
qplot(x=LATITUDE,y=LONGITUDE, data=locations)
library(dplyr)
library(ggplot2)
qplot(x=LATITUDE,y=LONGITUDE, data=locations)
coupons_area_train %>% names()
area_train <- coupons_area_train %>% select(PREF_NAME, COUPON_ID_hash) %>% unique()
class(area_train)
dim(area_train)
dim(coupons_area_train)
explain(locations)
area_train <- coupons_area_train %>% select(PREF_NAME, COUPON_ID_hash) %>% unique()
locations_train <- left_join(area_train, locations, by="PREF_NAME")
dim(locations_train)
dim(area_train)
area_train <- left_join(area_train, locations, by="PREF_NAME")
dim(area_train)
summary(area_train)
locations$PREFECTUAL_OFFICE %>% unique() %>% dim()
locations$PREFECTUAL_OFFICE %>% unique() %>% length()
ls()
names(coupons_train)
area_train <- left_join(coupons_train, area_train, by="COUPON_ID_hash")
class(coupons_train$COUPON_ID_hash)
area_train <- coupons_area_train %>% select(PREF_NAME, COUPON_ID_hash) %>% unique()
area_train <- left_join(area_train, locations, by="PREF_NAME")
names(area_train)
class(area_train$COUPON_ID_hash)
# dropping SMALL_AREA_NAME
area_train <- coupons_area_train %>% select(PREF_NAME, COUPON_ID_hash) %>% unique()
# joining with location data
area_train <- left_join(area_train, locations, by="PREF_NAME")
# joining with training coupons
coupons_train$COUPON_ID_hash <- as.character(coupons_train$COUPON_ID_hash)
area_train$COUPON_ID_hash <- as.character(area_train$COUPON_ID_hash)
area_train <- left_join(coupons_train, area_train, by="COUPON_ID_hash")
area_train$COUPON_ID_hash <- as.factor(area_train$COUPON_ID_hash)
dim(area_train)
names(area_train)
dim(coupons_train)
dim(coupons_area_train)
ls()
library(dplyr)
library(ggplot2)
load("data/base.RData")
area_train <- coupons_area_train %>% select(PREF_NAME, COUPON_ID_hash) %>% unique()
area_train <- left_join(coupons_train, area_train, by=COUPON_ID_hash)
library(dplyr)
library(ggplot2)
load("data/base.RData")
dim(coupons_area_train)
dim(unique(coupons_area_train))
area_train <- coupons_area_train %>% select(PREF_NAME, COUPON_ID_hash) %>% unique()
dim(area_train)
area_train <- left_join(area_train, locations, by="PREF_NAME")
dim(area_train)
area_train %>% unique() %>% dim()
area_train <- left_join(coupons_train, area_train, by="COUPON_ID_hash")
dim(area_train)
class(area_train$COUPON_ID_hash)
area_train$COUPON_ID_hash <- as.factor(area_train$COUPON_ID_hash)
names(area_train)
area_train %>% unique() %>% dim()
coupons_train$COUPON_ID_hash %>% unique() %>% length()
dim(coupons_train)
coupons_train %>% summary()
source('G:/Projects/coupon_purchase_prediction/source_R/area_listings.R')
ls()
dim(area_train)
dim(test)
summary(test)
summary(area_train)
test$COUPON_ID_hash <- as.factor(test$COUPON_ID_hash)
summary(test)
names(area_train)
temp <- test %>% select(PREF_NAME, COUPON_ID_hash, PREFECTUAL_OFFICE, LATITUDE, LONGITUDE)
unique(temp) %>% dim()
dim(area_train)
temp %>% filter(!(PREF_NAME %in% area_train$PREF_NAME)) %>% dim()
24+45
temp %>% filter(!(PREF_NAME %in% area_train$PREF_NAME))
test %>% filter(is.na(PREF_NAME)) %>% dim()
test %>% filter(is.na(PREF_NAME)) %>% names()
test %>% filter(is.na(PREF_NAME)) %>% select(COUPON_ID_hash, CAPSULE_TEXT, PRICE_RATE)
test %>% filter(is.na(PREF_NAME)) %>% select(COUPON_ID_hash)
test %>% filter(is.na(PREF_NAME)) %>% select(COUPON_ID_hash) %>% unique()
source('G:/Projects/coupon_purchase_prediction/source_R/area_listings.R')
ls()
names(area_train)
dim(area_train)
locations %>% select(LATITUDE, LONGITUDE) %>% unique() %>% dim()
locations %>% select(LATITUDE) %>% unique() %>% dim()
locations %>% select(LONGITUDE) %>% unique() %>% dim()
counts <- area_train %>% group_by(COUPON_ID_hash) %>% summarise(COUNT=n())
dim(counts)
names(counts)
counts <- counts %>% group_by(COUNT) %>% summarise(NUM_IDS=n())
counts
qplot(x=NUM_IDS, y=COUNT, data=counts)
dim(counts)
class(counts)
as.data.frame(counts0)
as.data.frame(counts)
counts %>% filter(COUNT > 30) %>% dim()
counts %>% filter(COUNT > 30) %>% select(NUM_IDS) %>% sum()
counts %>% filter(COUNT <= 30, COUNT > 20) %>% select(NUM_IDS) %>% sum()
counts %>% filter(COUNT <= 20, COUNT > 10) %>% select(NUM_IDS) %>% sum()
counts %>% filter(COUNT <= 10) %>% select(NUM_IDS) %>% sum()
names(coupons_test)
coupons_test %>% select(grep("USABLE", names(coupons_test))) %>% summary()
coupons_test %>% select(grep("USABLE", names(coupons_test))) %>% sapply(as.factor) %>% summary()
summary(coupons_train)
melt
library(reshape2)
library(RColorBrewer)
library(dplyr)
library(ggplot2)
library(reshape2)
library(RColorBrewer)
source('G:/Projects/coupon_purchase_prediction/source_R/missing_values.R')
hmap(coupons_test)
hmap(coupons_train)
names(coupons_train)
coupons_train$CAPSULE_TEXT %>% unique() %>% dim()
coupons_train$CAPSULE_TEXT %>% unique() %>% length()
coupons_train$GENRE_NAME %>% unique() %>% length()
coupons_train %>% filter(is.na(VALIDPERIOD)) %>% select(CAPSULE_TEXT) %>% unique() %>% dim()
coupons_train %>% filter(is.na(VALIDPERIOD)) %>% select(GENRE_NAME) %>% unique() %>% dim()
coupons_train %>% filter(is.na(VALIDPERIOD)) %>% select(GENRE_NAME) %>% unique()
genres <- coupons_train %>% filter(is.na(VALIDPERIOD)) %>% select(GENRE_NAME) %>% unique()
capsules <- coupons_train %>% filter(is.na(VALIDPERIOD)) %>% select(CAPSULE_TEXT) %>% unique()
class(genres)
class(capsules)
as.character(capsules)
as.character(capsules$CAPSULE_TEXT)
as.character(genres$GENRE_NAME)
ls()
hmap(user_list)
names(user_list)
hmap(details_train)
hmap(locations)
hmap(coupons_area_train)
hmap(coupons_area_test)
hmap(visits_train)
library(dplyr)
load("data/base.RData")
source('G:/Projects/coupon_purchase_prediction/source_R/missing_values.R')
ls()
hmap(coupons_train)
source('G:/Projects/coupon_purchase_prediction/source_R/missing_values.R')
hmap(coupons_train)
coupons_train$VALIDPERIOD %>% summary()
qplot(x=LATITUDE,y=LONGITUDE,data=locations)
getwd()
library(dplyr)
library(ggplot2)
load("data/base.RData")
ls()
names(coupons_train)
names(details_train)
locations
names(user_list)
names(coupons_train)
names(details_train)
ls()
names(visits_train)
dim(visits_train)
names(details_train)
details_train %>% select(ITEM_COUNT) %>% summary()
ls()
details_train %>% select(ITEM_COUNT) %>% summary()
details_train %>% select(ITEM_COUNT) %>% unique()
details_train %>% select(ITEM_COUNT) %>% unique() %>% sort()
details_train$ITEM_COUNT %>% unique() %>% sort()
details_train$ITEM_COUNT %>% unique() %>% sort() %>% len()
details_train$ITEM_COUNT %>% unique() %>% sort() %>% length()
val <- details_train %>% group_by(ITEM_COUNT) %>% summarise(NUM_USERS=n())
val
head(val, n=40)
val <- as.data.frame(val)
val
dim(user_list)
names(details_train)
val <- details_train %>% select(USER_ID_hash, ITEM_COUNT) %>% group_by(ITEM_COUNT)
val %>% dim()
class(val)
dim(details_train)
val <- details_train %>% select(USER_ID_hash, ITEM_COUNT) %>% group_by(ITEM_COUNT) %>% unique()
dim(val)
val
val$USER_ID_hash %>% unique() %>% lenght()
val$USER_ID_hash %>% unique() %>% length()
val <- val %>% summarise(NUM_USERS=n())
val
val <- as.data.frame(val)
val
dim(user_list)
val <- details_train %>% select(USER_ID_hash, ITEM_COUNT) %>% group_by(ITEM_COUNT) %>% unique()
summ <- val %>% summarise(NUM_USERS=n())
summ <- as.data.frame(summ)
head(val)
head(summ)
dim(details_train)
val %>% filter(ITEM_COUNT > 15) %>% dim()
val %>% filter(ITEM_COUNT > 15) %>% select(USER_ID_hash) %>% unique() %>% dim()
val %>% filter(ITEM_COUNT > 15) %>% select(USER_ID_hash) %>% unique()
many
many <- val %>% filter(ITEM_COUNT > 15) %>% select(USER_ID_hash) %>% unique()
many
dim(many)
as.data.frame(many)
as.data.frame(many) %>% sort(ITEM_COUNT)
as.data.frame(many) %>% sort()
as.data.frame(many) %>% sort(1)
summ
many$USER_ID_hash
details_train %>% filter(USER_ID_hash %in% many$USER_ID_hash) %>% dim()
dim(details_train)
load("data/base.RData")
ls()
library(dplyr)
library(ggplot2)
ls()
clear
ls()
dim(coupons_train)
dim(coupons_test)
dim(user_list)
m1 <- read.delim("m1_fname"scores/model_13.txt", encoding="UTF-8", header=TRUE, sep=",")
m1 <- read.delim("scores/model_13.txt", encoding="UTF-8", header=TRUE, sep=",")
m2 <- read.delim("scores/model_14.txt", encoding="UTF-8", header=TRUE, sep=",")
dim(m1)
dim(m2)
head(m1)
names(m1)
names(m1)[1]
names(m1)[2]
comb <- inner_join(m1, m2, by="users")
dim(comb)
head(comb)
comb["model_13"]
comb["difference"] <- comb[m2_name] - comb[m1_name]
m1_name <- names(m1)[2]
m2_name <- names(m2)[2]
comb["difference"] <- comb[m2_name] - comb[m1_name]
summary(comb)
comb %>% mutate(categories = difference)
comb %>% mutate(categories = difference) %>% shape
comb %>% mutate(categories = difference) %>% dim()
comb <- comb %>% mutate(categories = difference)
comb.head()
head(comb)
summary(comb)
comb <- comb %>% mutate(categories = replace(categories, categories < 0, "diminished"))
comb <- comb %>% mutate(categories = replace(categories, categories == 0, "unchanged"))
comb <- comb %>% mutate(categories = replace(categories, categories > 0, "improved"))
comb.head()
head(comb)
comb %>% summary()
comb$categories <- as.factor(comb$categories)
comb %>% summary()
dim(comb)
comb <- inner_join(m1, m2, by="users")
comb["difference"] <- comb[m2_name] - comb[m1_name]
comb <- comb %>% mutate(categories = difference)
comb <- comb %>% mutate(categories = replace(categories, difference < 0, "diminished"))
comb <- comb %>% mutate(categories = replace(categories, difference == 0, "unchanged"))
comb <- comb %>% mutate(categories = replace(categories, difference > 0, "improved"))
comb$categories <- as.factor(comb$categories)
summary(comb)
library(dplyr)
library(ggplot2)
compare_map <- function(m1_fname, m2_fname){
m1 <- read.delim(m1_fname, encoding="UTF-8", header=TRUE, sep=",")
m2 <- read.delim(m2_fname, encoding="UTF-8", header=TRUE, sep=",")
m1_name <- names(m1)[2]
m2_name <- names(m2)[2]
comb <- inner_join(m1, m2, by="users")
comb["difference"] <- comb[m2_name] - comb[m1_name]
comb <- comb %>% mutate(categories = difference)
comb <- comb %>% mutate(categories = replace(categories, difference < 0, "diminished"))
comb <- comb %>% mutate(categories = replace(categories, difference == 0, "unchanged"))
comb <- comb %>% mutate(categories = replace(categories, difference > 0, "improved"))
comb$categories <- as.factor(comb$categories)
return(comb)
}
compare_map("scores/model_14.txt", "scores/model_13.txt") %>% select(categories) %>% summary()
compare_map("scores/model_13.txt", "scores/model_15.txt") %>% select(categories) %>% summary()
compare_map("scores/model_13.txt", "scores/model_16.txt") %>% select(categories) %>% summary()
compare_map("scores/model_15.txt", "scores/model_16.txt") %>% select(categories) %>% summary()
paste("hello", "world")
paste("hello", "world", sep="")
c1 <- compare_map("scores/model_14.txt", "scores/model_13.txt")
c2 <- compare_map("scores/model_13.txt", "scores/model_16.txt")
comb <- inner_join(c1, c2, by="users")
comb %>% head()
comb <- comb %>% mutate(combined_categories = paste(categories.x, categories.y))
comb %>% head()
comb %>% select(combined_categories) %>% summary()
comb$combined_categories <- as.factor(comb$combined_categories)
comb %>% select(combined_categories) %>% summary()
comb_compare_map <- function(comb1, comb2){
comb <- inner_join(comb1, comb2, by="users")
comb <- comb %>% mutate(combined_categories = paste(categories.x, categories.y))
comb$combined_categories <- as.factor(comb$combined_categories)
return(comb)
}
c1 <- compare_map("scores/model_14.txt", "scores/model_13.txt")
c2 <- compare_map("scores/model_13.txt", "scores/model_15.txt")
comb_compare_map(c1, c2) %>% select(combined_categories) %>% summary()
comb_compare_map(c1, c2) %>% select(combined_categories) %>% summary(n=10)
comb_compare_map(c1, c2) %>% select(combined_categories) %>% summary(100)
ls()
names(visits_train)
summary(visits_train)
visits_train %>% select(PURCHASE_FLG) %>% unique()
visits_train %>% select(PURCHASE_FLG) %>% as.factor() %>% summary()
visits_train$PURCHASE_FLG %>% as.factor() %>% summary()
names(visits_train)
names(details_train)
details_train %>% group_by(USER_ID_hash) %>% summarise(COUNT=n()) %>% dim()
dim(details_train)
dim(user_list)
details_train %>% group_by(USER_ID_hash) %>% summarise(COUNT=n()) %>% filter(COUNT = 0)
details_train %>% group_by(USER_ID_hash) %>% summarise(COUNT=n()) %>% filter(COUNT == 0)
details_train %>% group_by(USER_ID_hash) %>% summarise(COUNT=n()) %>% filter(COUNT > 1) %>% dim()
details_train %>% group_by(USER_ID_hash) %>% summarise(COUNT=n()) %>% ungroup() %>% group_by(COUNT) %>% summarise(INT_COUNT=n())
details_train %>% group_by(USER_ID_hash) %>% summarise(COUNT=n()) %>% ungroup() %>% group_by(COUNT) %>% summarise(INT_COUNT=n()) %>% as.data.frame()
details_train %>% group_by(USER_ID_hash) %>% summarise(COUNT=n()) %>% ungroup() %>% group_by(COUNT) %>% summarise(INT_COUNT=n()) %>% arrange(INT_COUNT)
details_train %>% group_by(USER_ID_hash) %>% summarise(COUNT=n()) %>% ungroup() %>% group_by(COUNT) %>% summarise(INT_COUNT=n()) %>% arrange(desc(INT_COUNT)) %>% as.data.frame()
details_train %>% group_by(USER_ID_hash) %>% summarise(COUNT=n()) %>% filter(COUNT > 10) %>% dim()
dim(user_list)
visits_train %>% group_by(USER_ID_hash) %>% summarise(COUNT=n()) %>% filter(COUNT > 10) %>% dim()
visits_train %>% group_by(USER_ID_hash) %>% summarise(COUNT=n()) %>% filter(COUNT <= 10) %>% dim()
load("data/base.RData")
library(dplyr)
ls()
ls()
names(coupons_train)
names(coupons_test)
names(details_train)
names(visits_train)
names(locations)
names(user_list)
names(coupons_area_train)
dim(user_list)
dim(coupons_train)
dim(coupons_train)[1] * dim(user_list)[1]
dim(coupons_test)
library(dplyr)
load("data/base.RData")
ls()
library(dplyr)
load("data/base.RData")
ls()
dim(details_train)
purchases = details_train
visits = visits_train
dim(visits)
dim(purchases)
dim(visits)[1] / dim(purchases)[1]
dim(user_list)
dim(purchases)
names(visits)
